{% load static %}
{% load chunks %}
<!-- Products Start -->

<div class="container-fluid pt-5">
    <div class="text-center mb-4">
        <h2 class="section-title px-5"><span class="px-2">Just Arrived</span></h2>
    </div>
    {% if products_with_attributes %}
            {% for product_with_attribute in products_with_attributes %}
            {% if forloop.counter0|divisibleby:4 %}
            <div class="row px-xl-5 pb-3">
                {% endif %}
                    <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
                        <div class="card product-item border-0 mb-4">
                            <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
                                <img class="img-fluid w-100" style="height:300px;" src="{{ product_with_attribute.first_attribute.image.url }}" alt="">
                            </div>
                            <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
                                <h6 class="text-truncate mb-3">{{ product_with_attribute.product.name }}</h6>
                                <p>Size : {{ product_with_attribute.first_attribute.size }} , Color : {{ product_with_attribute.first_attribute.color }}</p>
                                <div class="d-flex justify-content-center mt-2"> 
                                    {% if  product_with_attribute.first_attribute.offer_price %}                      
                                    <h6 class="data-price product-price">Rs {{ product_with_attribute.first_attribute.offer_price }}</h6><h6 class="text-muted ml-2"><del>Rs {{ product_with_attribute.first_attribute.price }}</del></h6>
                                    <p class="text-success ml-3"> {{ product_with_attribute.discount_percentage }} % off</p>
                                    {% else %}
                                    <h6 class="data-price product-price">Rs {{ product_with_attribute.first_attribute.price }}</h6>
                                    {% endif %}
                                </div>
                                {% if product_with_attribute.first_attribute.stock > 0 %}
                                    {% if product_with_attribute.first_attribute.stock < 6 %}
                                        <p class="text-danger small mb-0">Only {{ product_with_attribute.first_attribute.stock }} stock left</p>
                                    {% else %}
                                        <p class="text-success small mb-0"> In stock</p>
                                    {% endif %}
                                {% else %}
                                    <p class="text-danger small mb-0">Out Of stock</p>
                                {% endif %}
                                {% if product_with_attribute.discount_percentage %}
                                    {% if product_with_attribute.product_offer and product_with_attribute.category_offer %}
                                        {% if product_with_attribute.product_offer.discount_percentage > product_with_attribute.category_offer.discount_percentage %}
                                            <p>{{ product_with_attribute.product_offer.name }}</p>
                                            {% if product_with_attribute.p_remaining_days > 0 %}
                                                <p class="text-success">Offer Ends In: {{ product_with_attribute.p_remaining_days }} days</p>
                                            {% elif product_with_attribute.p_remaining_days == 0 %}
                                                <p class="text-danger">Offer will end today</p>
                                            {% else %}
                                                <p class="text-danger">Offer has ended</p>
                                            {% endif %}
                                        {% else %}
                                            <p>{{ product_with_attribute.category_offer.name }}</p>
                                                {% if product_with_attribute.c_remaining_days > 0 %}
                                                    <p class="text-success">Offer Ends In: {{ product_with_attribute.c_remaining_days }} days</p>
                                                {% elif product_with_attribute.p_remaining_days == 0 %}
                                                    <p class="text-danger">Offer will end today</p>
                                                {% else %}
                                                    <p class="text-danger">Offer has ended</p>
                                                {% endif %}
                                            {% endif %}
                                    {% elif product_with_attribute.product_offer %}
                                        <p> {{ product_with_attribute.product_offer.name }}</p>
                                            {% if product_with_attribute.p_remaining_days > 0 %}
                                                <p class="text-success">Offer Ends In: {{ product_with_attribute.p_remaining_days }} days</p>
                                            {% elif product_with_attribute.p_remaining_days == 0 %}
                                                <p class="text-danger">Offer will end today</p>
                                            {% else %}
                                                <p class="text-danger">Offer has ended</p>
                                            {% endif %}
                                    {% elif product_with_attribute.category_offer %}
                                        <p> {{ product_with_attribute.category_offer.name }}</p>
                                            {% if product_with_attribute.c_remaining_days > 0 %}
                                                <p class="text-success">Offer Ends In: {{ product_with_attribute.c_remaining_days }} days</p>
                                            {% elif product_with_attribute.p_remaining_days == 0 %}
                                                <p class="text-danger">Offer will end today</p>
                                            {% else %}
                                                <p class="text-danger">Offer has ended</p>
                                            {% endif %}
                                    {% endif %}
                                
                                {% endif %}
                        
                            </div>
                          
                            <div class="card-footer d-flex justify-content-between bg-light border">
                                <a href="{{ product_with_attribute.product.get_url }}" class="btn btn-sm text-dark p-0"><i class="fas fa-eye text-primary mr-1"></i>View Detail</a>
                                <a href="{% url 'add_wishlist' product_with_attribute.product.id %}" class="btn btn-sm text-dark p-0"><i class="fas fa-heart text-primary mr-1"></i>Add To Wishlist</a>
                            </div>
                        </div>
                    </div>
                    {% if forloop.counter|divisibleby:4 or forloop.last %}
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
            <div class='ml-3'>
                <h3 class="m-0">No result found.Please try again .</h3>
            </div>
    {% endif %}
</div>
<!-- Products End -->